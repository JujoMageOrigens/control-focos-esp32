#include <WiFi.h>
#include <HTTPClient.h>

const char* ssid = "TuRedWiFi";  // Cambia esto con tu SSID
const char* password = "TuContraseña";  // Cambia esto con tu contraseña

String url = "https://tu-usuario.github.io/control-focos-esp32/estado.json";
String estadoAnterior = "";

void setup() {
    Serial.begin(115200);
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(1000);
        Serial.println("Conectando a WiFi...");
    }
    Serial.println("Conectado a WiFi");
}

void loop() {
    if (WiFi.status() == WL_CONNECTED) {
        HTTPClient http;
        http.begin(url);
        int httpResponseCode = http.GET();

        if (httpResponseCode == 200) {
            String payload = http.getString();
            Serial.println("Estado recibido: " + payload);

            if (payload.indexOf("ON") > 0 && estadoAnterior != "ON") {
                Serial.println("ON"); // Enviar al Arduino
                estadoAnterior = "ON";
            } else if (payload.indexOf("OFF") > 0 && estadoAnterior != "OFF") {
                Serial.println("OFF"); // Enviar al Arduino
                estadoAnterior = "OFF";
            }
        } else {
            Serial.println("Error al obtener datos");
        }
        http.end();
    }
    delay(5000); // Consultar cada 5 segundos
}
